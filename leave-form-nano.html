<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ö‡∏•‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå - ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏ô‡∏≤‡πÇ‡∏ô ‡∏°‡∏¥‡πÄ‡∏£‡∏≠‡∏£‡πå ‡∏≠‡∏¥‡∏ô‡∏î‡∏±‡∏™‡∏ó‡∏£‡∏µ‡πâ ‡∏à‡∏≥‡∏Å‡∏±‡∏î</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #16a34a;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 50;
    }
    .toast.show { opacity: 1; transform: translateY(0); }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col items-center p-6">

  <div class="bg-white shadow-lg rounded-2xl w-full max-w-lg p-6 mb-6">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <img src="f1a71733-83ae-4b58-9795-d0637470168c.png" alt="NANO Logo" class="h-10">
        <div>
          <h1 class="text-xl font-bold text-gray-800">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏ô‡∏≤‡πÇ‡∏ô ‡∏°‡∏¥‡πÄ‡∏£‡∏≠‡∏£‡πå ‡∏≠‡∏¥‡∏ô‡∏î‡∏±‡∏™‡∏ó‡∏£‡∏µ‡πâ ‡∏à‡∏≥‡∏Å‡∏±‡∏î</h1>
          <p class="text-sm text-gray-500">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ö‡∏•‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
        </div>
      </div>
      <button id="langToggle" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-1 rounded-lg text-sm">·Äô·Äº·Äî·Ä∫·Äô·Ä¨</button>
    </div>

    <div id="currentTimeBox" class="bg-green-50 border border-green-200 text-green-700 text-sm p-3 rounded-md mb-4 text-center">
      <span id="currentTime"></span>
    </div>

    <!-- ‚úÖ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡∏•‡∏≤ -->
    <div class="bg-blue-50 border border-blue-200 text-blue-800 p-3 rounded-lg mb-4 text-sm">
      <p><strong>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡∏•‡∏≤:</strong></p>
      <ul class="list-disc ml-5">
        <li>‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏∑‡πà‡∏ô‡πÉ‡∏ö‡∏•‡∏≤‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô</li>
        <li>‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏•‡∏≤‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô</li>
        <li>‡∏Å‡∏£‡∏ì‡∏µ‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
        <li>‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏•‡∏≤‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</li>
      </ul>
    </div>

    <form id="leaveForm" class="space-y-4">
      <div>
        <label class="block text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
        <input type="text" id="empId" class="w-full p-2 border rounded-lg" required>
      </div>
      <div>
        <label class="block text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
        <input type="text" id="empName" class="w-full p-2 border rounded-lg" required>
      </div>
      <div>
        <label class="block text-gray-700">‡πÅ‡∏ú‡∏ô‡∏Å</label>
        <input type="text" id="department" class="w-full p-2 border rounded-lg" required>
      </div>
      <div>
        <label class="block text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
        <select id="leaveType" class="w-full p-2 border rounded-lg" required>
          <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤ --</option>
          <option>‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
          <option>‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå</option>
          <option>‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå</option>
          <option>‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô</option>
          <option>‡∏å‡∏≤‡∏õ‡∏ì‡∏Å‡∏¥‡∏à</option>
          <option>‡∏•‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
        </select>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏≤</label>
          <input type="date" id="startDate" class="w-full p-2 border rounded-lg" required>
        </div>
        <div>
          <label class="block text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏•‡∏≤</label>
          <input type="date" id="endDate" class="w-full p-2 border rounded-lg" required>
        </div>
      </div>
      <div>
        <label class="block text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤ (‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</label>
        <input type="text" id="leaveDays" readonly class="w-full p-2 border bg-gray-100 rounded-lg">
      </div>
      <div>
        <label class="block text-gray-700">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
        <textarea id="reason" rows="3" class="w-full p-2 border rounded-lg" required></textarea>
      </div>
      <div>
        <label class="block text-gray-700">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
        <input type="file" id="medicalFile" accept="image/*" class="w-full p-2 border rounded-lg">
      </div>
      <div>
        <label class="block text-gray-700">‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</label>
        <input type="text" id="approver" class="w-full p-2 border rounded-lg" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" required>
      </div>
      <div>
        <label class="block text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏•‡∏≤</label>
        <input type="date" id="submitDate" class="w-full p-2 border rounded-lg" required>
      </div>
      <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded-lg font-semibold hover:bg-blue-700 transition">‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏•‡∏≤</button>
    </form>
  </div>

  <div class="bg-white shadow-lg rounded-2xl w-full max-w-6xl p-6">
    <h2 class="text-lg font-semibold mb-4">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ö‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå)</h2>
    <table class="w-full border border-gray-200 text-sm text-left">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2 border">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
          <th class="p-2 border">‡∏ä‡∏∑‡πà‡∏≠</th>
          <th class="p-2 border">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏≤</th>
          <th class="p-2 border">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°</th>
          <th class="p-2 border">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</th>
          <th class="p-2 border">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤</th>
          <th class="p-2 border">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏•‡∏≤</th>
          <th class="p-2 border">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
          <th class="p-2 border">‡∏•‡∏ö</th>
        </tr>
      </thead>
      <tbody id="leaveTable"></tbody>
    </table>
  </div>

  <div id="toast" class="toast">‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏•‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‚úÖ</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const form = document.getElementById('leaveForm');
    const toast = document.getElementById('toast');
    const leaveTable = document.getElementById('leaveTable');
    const currentTime = document.getElementById('currentTime');

    function showToast(message, success = true) {
      toast.textContent = message;
      toast.style.background = success ? '#16a34a' : '#dc2626';
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 4000);
    }

    function updateCurrentTime() {
      const now = new Date();
      const thaiDate = now.toLocaleDateString('th-TH', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
      const thaiTime = now.toLocaleTimeString('th-TH');
      currentTime.innerHTML = `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏£‡∏∞‡∏ö‡∏ö): <strong>${thaiDate} ‡πÄ‡∏ß‡∏•‡∏≤ ${thaiTime}</strong>`;
    }
    setInterval(updateCurrentTime, 1000);
    updateCurrentTime();

    function calculateLeaveDays() {
      const start = new Date(form.startDate.value);
      const end = new Date(form.endDate.value);
      if (form.startDate.value && form.endDate.value && end >= start) {
        const diff = (end - start) / (1000 * 60 * 60 * 24) + 1;
        form.leaveDays.value = diff + ' ‡∏ß‡∏±‡∏ô';
        return diff;
      }
      form.leaveDays.value = '';
      return 0;
    }
    form.startDate.addEventListener('change', calculateLeaveDays);
    form.endDate.addEventListener('change', calculateLeaveDays);

    // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏é‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const leaveType = form.leaveType.value;
      const submitDate = new Date(form.submitDate.value);
      const start = new Date(form.startDate.value);
      const now = new Date();

      if (leaveType === '‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô') {
        const isSubmitAfterStart = submitDate >= start; // ‚ùå ‡∏´‡πâ‡∏≤‡∏°‡∏™‡πà‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤
        const isSubmitBeforeToday = submitDate < new Date(now.setHours(0, 0, 0, 0));

        if (isSubmitAfterStart || isSubmitBeforeToday) {
          showToast('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ\n‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏•‡∏≤‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î', false);
          return;
        }
      }

      let fileURL = '';
      const file = document.getElementById('medicalFile').files[0];
      const leaveDays = calculateLeaveDays();

      try {
        if (file) {
          const fileRef = ref(storage, '‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå/' + file.name);
          await uploadBytes(fileRef, file);
          fileURL = await getDownloadURL(fileRef);
        }
        await addDoc(collection(db, '‡πÉ‡∏ö‡∏•‡∏≤'), {
          empId: form.empId.value,
          empName: form.empName.value,
          department: form.department.value,
          leaveType: form.leaveType.value,
          startDate: form.startDate.value,
          endDate: form.endDate.value,
          leaveDays: leaveDays,
          reason: form.reason.value,
          approver: form.approver.value,
          submitDate: form.submitDate.value,
          createdAt: serverTimestamp()
        });
        form.reset();
        showToast('‚úÖ ‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏•‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß');
      } catch (err) {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message, false);
      }
    });

    const q = query(collection(db, '‡πÉ‡∏ö‡∏•‡∏≤'), orderBy('createdAt', 'desc'));
    onSnapshot(q, (snapshot) => {
      leaveTable.innerHTML = '';
      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const tr = document.createElement('tr');
        const updateTime = data.createdAt?.toDate?.().toLocaleString('th-TH') || '-';
        tr.innerHTML = `
          <td class='p-2 border text-center'>${data.empId || '-'}</td>
          <td class='p-2 border'>${data.empName || '-'}</td>
          <td class='p-2 border'>${data.leaveType || '-'}</td>
          <td class='p-2 border'>${data.startDate || '-'}</td>
          <td class='p-2 border'>${data.endDate || '-'}</td>
          <td class='p-2 border text-center'>${data.leaveDays || '-'}</td>
          <td class='p-2 border text-center'>${data.submitDate || '-'}</td>
          <td class='p-2 border text-center text-gray-600'>${updateTime}</td>
          <td class='p-2 border text-center'>
            <button class='text-red-500 hover:text-red-700' data-id='${docSnap.id}'>üóëÔ∏è</button>
          </td>
        `;
        leaveTable.appendChild(tr);
      });

      document.querySelectorAll('button[data-id]').forEach((btn) => {
        btn.addEventListener('click', async (e) => {
          const id = e.currentTarget.getAttribute('data-id');
          if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
            await deleteDoc(doc(db, '‡πÉ‡∏ö‡∏•‡∏≤', id));
            showToast('üóëÔ∏è ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
          }
        });
      });
    });

    document.addEventListener('DOMContentLoaded', () => {
      const langBtn = document.getElementById('langToggle');
      let currentLang = 'th';
      langBtn.addEventListener('click', () => {
        currentLang = currentLang === 'th' ? 'mm' : 'th';
        langBtn.textContent = currentLang === 'th' ? '·Äô·Äº·Äî·Ä∫·Äô·Ä¨' : '‡πÑ‡∏ó‡∏¢';
      });
    });
  </script>
</body>
</html>
